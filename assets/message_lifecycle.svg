<svg width="900" height="400" xmlns="http://www.w3.org/2000/svg">
  <rect width="900" height="400" fill="transparent"/>
  
  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#e0e0e0">
    Message Lifecycle in BunnyFarm
  </text>
  
  <!-- Stage boxes -->
  <defs>
    <marker id="arrow-lifecycle" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ff9800"/>
    </marker>
  </defs>
  
  <!-- Stage 1: Creation -->
  <g>
    <rect x="50" y="80" width="140" height="80" rx="10" fill="#2d3748" stroke="#68d391" stroke-width="2"/>
    <text x="120" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#68d391">1. Creation</text>
    <text x="120" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">message = OrderMessage.new</text>
    <text x="120" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">message[:order_id] = 12345</text>
    <text x="120" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">Set data fields</text>
  </g>
  
  <!-- Stage 2: Publishing -->
  <g>
    <rect x="220" y="80" width="140" height="80" rx="10" fill="#2d3748" stroke="#4299e1" stroke-width="2"/>
    <text x="290" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#4299e1">2. Publishing</text>
    <text x="290" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">message.publish('process')</text>
    <text x="290" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">Serialize to JSON</text>
    <text x="290" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">Send to RabbitMQ</text>
  </g>
  
  <!-- Stage 3: Routing -->
  <g>
    <rect x="390" y="80" width="140" height="80" rx="10" fill="#2d3748" stroke="#9f7aea" stroke-width="2"/>
    <text x="460" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#9f7aea">3. Routing</text>
    <text x="460" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">Key: OrderMessage.process</text>
    <text x="460" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">Exchange → Queue</text>
    <text x="460" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">Route to consumer</text>
  </g>
  
  <!-- Stage 4: Consumption -->
  <g>
    <rect x="560" y="80" width="140" height="80" rx="10" fill="#2d3748" stroke="#f6e05e" stroke-width="2"/>
    <text x="630" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#f6e05e">4. Consumption</text>
    <text x="630" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">Deserialize JSON</text>
    <text x="630" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">Create instance</text>
    <text x="630" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">Call process() method</text>
  </g>
  
  <!-- Stage 5: Acknowledgment -->
  <g>
    <rect x="730" y="80" width="140" height="80" rx="10" fill="#2d3748" stroke="#e53e3e" stroke-width="2"/>
    <text x="800" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#e53e3e">5. Acknowledgment</text>
    <text x="800" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">successful? → ACK</text>
    <text x="800" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">failed? → NACK</text>
    <text x="800" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">Remove from queue</text>
  </g>
  
  <!-- Flow arrows -->
  <line x1="190" y1="120" x2="220" y2="120" stroke="#ff9800" stroke-width="3" marker-end="url(#arrow-lifecycle)"/>
  <line x1="360" y1="120" x2="390" y2="120" stroke="#ff9800" stroke-width="3" marker-end="url(#arrow-lifecycle)"/>
  <line x1="530" y1="120" x2="560" y2="120" stroke="#ff9800" stroke-width="3" marker-end="url(#arrow-lifecycle)"/>
  <line x1="700" y1="120" x2="730" y2="120" stroke="#ff9800" stroke-width="3" marker-end="url(#arrow-lifecycle)"/>
  
  <!-- Data representation -->
  <g>
    <text x="450" y="210" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#e0e0e0">Data Transformation</text>
    
    <!-- Ruby Object -->
    <rect x="50" y="230" width="180" height="120" rx="8" fill="#1a202c" stroke="#68d391" stroke-width="1"/>
    <text x="140" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#68d391">Ruby Object</text>
    <text x="60" y="270" font-family="monospace" font-size="10" fill="#e0e0e0">message = OrderMessage.new</text>
    <text x="60" y="285" font-family="monospace" font-size="10" fill="#e0e0e0">message[:order_id] = 12345</text>
    <text x="60" y="300" font-family="monospace" font-size="10" fill="#e0e0e0">message[:customer] = {</text>
    <text x="70" y="315" font-family="monospace" font-size="10" fill="#e0e0e0">name: "John Doe",</text>
    <text x="70" y="330" font-family="monospace" font-size="10" fill="#e0e0e0">email: "john@example.com"</text>
    <text x="60" y="345" font-family="monospace" font-size="10" fill="#e0e0e0">}</text>
    
    <!-- Arrow -->
    <line x1="240" y1="290" x2="280" y2="290" stroke="#ff9800" stroke-width="2" marker-end="url(#arrow-lifecycle)"/>
    <text x="260" y="285" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#ff9800">serialize</text>
    
    <!-- JSON -->
    <rect x="290" y="230" width="200" height="120" rx="8" fill="#1a202c" stroke="#4299e1" stroke-width="1"/>
    <text x="390" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#4299e1">JSON Message</text>
    <text x="300" y="270" font-family="monospace" font-size="10" fill="#e0e0e0">{</text>
    <text x="310" y="285" font-family="monospace" font-size="10" fill="#e0e0e0">"order_id": 12345,</text>
    <text x="310" y="300" font-family="monospace" font-size="10" fill="#e0e0e0">"customer": {</text>
    <text x="320" y="315" font-family="monospace" font-size="10" fill="#e0e0e0">"name": "John Doe",</text>
    <text x="320" y="330" font-family="monospace" font-size="10" fill="#e0e0e0">"email": "john@example.com"</text>
    <text x="310" y="345" font-family="monospace" font-size="10" fill="#e0e0e0">}</text>
    <text x="300" y="360" font-family="monospace" font-size="10" fill="#e0e0e0">}</text>
    
    <!-- Arrow -->
    <line x1="500" y1="290" x2="540" y2="290" stroke="#ff9800" stroke-width="2" marker-end="url(#arrow-lifecycle)"/>
    <text x="520" y="285" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#ff9800">deserialize</text>
    
    <!-- Processed Object -->
    <rect x="550" y="230" width="180" height="120" rx="8" fill="#1a202c" stroke="#68d391" stroke-width="1"/>
    <text x="640" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#68d391">Processed Object</text>
    <text x="560" y="270" font-family="monospace" font-size="10" fill="#e0e0e0">def process</text>
    <text x="570" y="285" font-family="monospace" font-size="10" fill="#e0e0e0">validate_order</text>
    <text x="570" y="300" font-family="monospace" font-size="10" fill="#e0e0e0">charge_payment</text>
    <text x="570" y="315" font-family="monospace" font-size="10" fill="#e0e0e0">update_inventory</text>
    <text x="570" y="330" font-family="monospace" font-size="10" fill="#e0e0e0">success!</text>
    <text x="560" y="345" font-family="monospace" font-size="10" fill="#e0e0e0">end</text>
  </g>
</svg>