<svg width="1000" height="700" xmlns="http://www.w3.org/2000/svg">
  <rect width="1000" height="700" fill="transparent"/>
  
  <!-- Title -->
  <text x="500" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#e0e0e0">
    E-commerce Order Processing Example
  </text>
  
  <!-- Order Processing Flow -->
  <g>
    <text x="500" y="70" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#68d391">
      Complete Order Processing Workflow
    </text>
    
    <!-- Step 1: Order Created -->
    <rect x="50" y="100" width="160" height="80" rx="8" fill="#2d3748" stroke="#68d391" stroke-width="2"/>
    <text x="130" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#68d391">1. Order Created</text>
    <text x="60" y="145" font-family="monospace" font-size="10" fill="#e0e0e0">OrderMessage.new</text>
    <text x="60" y="160" font-family="monospace" font-size="10" fill="#e0e0e0">order_id: 12345</text>
    <text x="60" y="175" font-family="monospace" font-size="10" fill="#e0e0e0">customer_id: "cust_789"</text>
    
    <!-- Step 2: Validate -->
    <rect x="240" y="100" width="160" height="80" rx="8" fill="#2d3748" stroke="#4299e1" stroke-width="2"/>
    <text x="320" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#4299e1">2. Validate Order</text>
    <text x="250" y="145" font-family="monospace" font-size="10" fill="#e0e0e0">msg.publish('validate')</text>
    <text x="250" y="160" font-family="monospace" font-size="10" fill="#e0e0e0">• Check inventory</text>
    <text x="250" y="175" font-family="monospace" font-size="10" fill="#e0e0e0">• Verify customer</text>
    
    <!-- Step 3: Payment -->
    <rect x="430" y="100" width="160" height="80" rx="8" fill="#2d3748" stroke="#9f7aea" stroke-width="2"/>
    <text x="510" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#9f7aea">3. Process Payment</text>
    <text x="440" y="145" font-family="monospace" font-size="10" fill="#e0e0e0">msg.publish('charge')</text>
    <text x="440" y="160" font-family="monospace" font-size="10" fill="#e0e0e0">• Charge card</text>
    <text x="440" y="175" font-family="monospace" font-size="10" fill="#e0e0e0">• Update status</text>
    
    <!-- Step 4: Fulfill -->
    <rect x="620" y="100" width="160" height="80" rx="8" fill="#2d3748" stroke="#f6e05e" stroke-width="2"/>
    <text x="700" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#f6e05e">4. Fulfill Order</text>
    <text x="630" y="145" font-family="monospace" font-size="10" fill="#e0e0e0">msg.publish('fulfill')</text>
    <text x="630" y="160" font-family="monospace" font-size="10" fill="#e0e0e0">• Pick items</text>
    <text x="630" y="175" font-family="monospace" font-size="10" fill="#e0e0e0">• Pack and ship</text>
    
    <!-- Step 5: Complete -->
    <rect x="810" y="100" width="160" height="80" rx="8" fill="#2d3748" stroke="#e53e3e" stroke-width="2"/>
    <text x="890" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#e53e3e">5. Complete</text>
    <text x="820" y="145" font-family="monospace" font-size="10" fill="#e0e0e0">msg.publish('complete')</text>
    <text x="820" y="160" font-family="monospace" font-size="10" fill="#e0e0e0">• Send receipt</text>
    <text x="820" y="175" font-family="monospace" font-size="10" fill="#e0e0e0">• Update CRM</text>
  </g>
  
  <!-- Message Definition -->
  <g>
    <text x="500" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#e0e0e0">
      OrderMessage Implementation
    </text>
    
    <rect x="50" y="250" width="900" height="160" rx="8" fill="#2d3748" stroke="#4299e1" stroke-width="2"/>
    <text x="500" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#4299e1">Complete Message Class</text>
    
    <text x="70" y="300" font-family="monospace" font-size="11" fill="#68d391">class OrderMessage &lt; BunnyFarm::Message</text>
    <text x="80" y="320" font-family="monospace" font-size="11" fill="#f6e05e">fields</text>
    <text x="130" y="320" font-family="monospace" font-size="11" fill="#e0e0e0">:order_id, :customer_id, :items, :total_amount, :status</text>
    <text x="80" y="340" font-family="monospace" font-size="11" fill="#f6e05e">actions</text>
    <text x="140" y="340" font-family="monospace" font-size="11" fill="#e0e0e0">:validate, :charge, :fulfill, :complete, :cancel</text>
    
    <text x="80" y="365" font-family="monospace" font-size="11" fill="#9f7aea">def validate</text>
    <text x="90" y="380" font-family="monospace" font-size="11" fill="#e0e0e0">return false unless inventory_available?</text>
    <text x="90" y="395" font-family="monospace" font-size="11" fill="#e0e0e0">publish('charge') if valid?</text>
    <text x="80" y="410" font-family="monospace" font-size="11" fill="#9f7aea">end</text>
    
    <text x="400" y="365" font-family="monospace" font-size="11" fill="#9f7aea">def charge</text>
    <text x="410" y="380" font-family="monospace" font-size="11" fill="#e0e0e0">payment = PaymentService.charge(total_amount)</text>
    <text x="410" y="395" font-family="monospace" font-size="11" fill="#e0e0e0">publish('fulfill') if payment.success?</text>
    <text x="400" y="410" font-family="monospace" font-size="11" fill="#9f7aea">end</text>
    
    <text x="70" y="430" font-family="monospace" font-size="11" fill="#68d391">end</text>
  </g>
  
  <!-- Routing Keys -->
  <g>
    <text x="500" y="470" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#e0e0e0">
      Generated Routing Keys and Queue Bindings
    </text>
    
    <!-- Routing Keys -->
    <rect x="50" y="490" width="300" height="120" rx="6" fill="#1a202c" stroke="#ff9800" stroke-width="1"/>
    <text x="200" y="510" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#ff9800">Generated Routing Keys</text>
    <text x="60" y="530" font-family="monospace" font-size="10" fill="#e0e0e0">OrderMessage.validate</text>
    <text x="60" y="545" font-family="monospace" font-size="10" fill="#e0e0e0">OrderMessage.charge</text>
    <text x="60" y="560" font-family="monospace" font-size="10" fill="#e0e0e0">OrderMessage.fulfill</text>
    <text x="60" y="575" font-family="monospace" font-size="10" fill="#e0e0e0">OrderMessage.complete</text>
    <text x="60" y="590" font-family="monospace" font-size="10" fill="#e0e0e0">OrderMessage.cancel</text>
    
    <!-- Queue Bindings -->
    <rect x="370" y="490" width="280" height="120" rx="6" fill="#1a202c" stroke="#68d391" stroke-width="1"/>
    <text x="510" y="510" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#68d391">Queue Binding Patterns</text>
    <text x="380" y="530" font-family="monospace" font-size="10" fill="#e0e0e0">OrderMessage.*</text>
    <text x="520" y="530" font-family="Arial, sans-serif" font-size="10" fill="#9ca3af"># All order operations</text>
    <text x="380" y="545" font-family="monospace" font-size="10" fill="#e0e0e0">*.validate</text>
    <text x="520" y="545" font-family="Arial, sans-serif" font-size="10" fill="#9ca3af"># All validation tasks</text>
    <text x="380" y="560" font-family="monospace" font-size="10" fill="#e0e0e0">*.charge</text>
    <text x="520" y="560" font-family="Arial, sans-serif" font-size="10" fill="#9ca3af"># Payment processing</text>
    <text x="380" y="575" font-family="monospace" font-size="10" fill="#e0e0e0">*.fulfill</text>
    <text x="520" y="575" font-family="Arial, sans-serif" font-size="10" fill="#9ca3af"># Fulfillment center</text>
    <text x="380" y="590" font-family="monospace" font-size="10" fill="#e0e0e0">urgent.*</text>
    <text x="520" y="590" font-family="Arial, sans-serif" font-size="10" fill="#9ca3af"># High priority queue</text>
    
    <!-- Consumer Examples -->
    <rect x="670" y="490" width="280" height="120" rx="6" fill="#1a202c" stroke="#9f7aea" stroke-width="1"/>
    <text x="810" y="510" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#9f7aea">Consumer Workers</text>
    <text x="680" y="530" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">Order Validation Worker</text>
    <text x="680" y="545" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">Payment Processing Worker</text>
    <text x="680" y="560" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">Fulfillment Worker</text>
    <text x="680" y="575" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">Notification Worker</text>
    <text x="680" y="590" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">Analytics Worker</text>
  </g>
  
  <!-- Error Handling -->
  <g>
    <text x="500" y="650" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#e0e0e0">
      Error Handling and Recovery
    </text>
    
    <rect x="100" y="670" width="200" height="25" rx="4" fill="#1a202c" stroke="#e53e3e" stroke-width="1"/>
    <text x="200" y="687" text-anchor="middle" font-family="monospace" font-size="10" fill="#e53e3e">Payment Failed - Retry - Cancel</text>
    
    <rect x="320" y="670" width="200" height="25" rx="4" fill="#1a202c" stroke="#f6e05e" stroke-width="1"/>
    <text x="420" y="687" text-anchor="middle" font-family="monospace" font-size="10" fill="#f6e05e">Inventory Low - Backorder Queue</text>
    
    <rect x="540" y="670" width="200" height="25" rx="4" fill="#1a202c" stroke="#4299e1" stroke-width="1"/>
    <text x="640" y="687" text-anchor="middle" font-family="monospace" font-size="10" fill="#4299e1">Ship Failed - Dead Letter - Manual</text>
  </g>
  
  <!-- Flow arrows -->
  <defs>
    <marker id="arrow-ecomm" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#ff9800"/>
    </marker>
  </defs>
  
  <line x1="210" y1="140" x2="240" y2="140" stroke="#ff9800" stroke-width="2" marker-end="url(#arrow-ecomm)"/>
  <line x1="400" y1="140" x2="430" y2="140" stroke="#ff9800" stroke-width="2" marker-end="url(#arrow-ecomm)"/>
  <line x1="590" y1="140" x2="620" y2="140" stroke="#ff9800" stroke-width="2" marker-end="url(#arrow-ecomm)"/>
  <line x1="780" y1="140" x2="810" y2="140" stroke="#ff9800" stroke-width="2" marker-end="url(#arrow-ecomm)"/>
</svg>