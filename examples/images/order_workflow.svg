<svg width="800" height="500" xmlns="http://www.w3.org/2000/svg">
  <!-- Background transparent -->
  <rect width="800" height="500" fill="transparent"/>
  
  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#e0e0e0">
    Order Processing Workflow
  </text>
  
  <!-- Workflow Steps -->
  
  <!-- Step 1: Validate -->
  <g>
    <rect x="50" y="70" width="120" height="80" rx="10" fill="#2d3748" stroke="#68d391" stroke-width="2"/>
    <text x="110" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#68d391">VALIDATE</text>
    <text x="110" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">‚Ä¢ Check email</text>
    <text x="110" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">‚Ä¢ Check amount</text>
    <text x="110" y="145" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">‚Ä¢ Update status</text>
  </g>
  
  <!-- Step 2: Process Payment -->
  <g>
    <rect x="250" y="70" width="120" height="80" rx="10" fill="#2d3748" stroke="#4299e1" stroke-width="2"/>
    <text x="310" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#4299e1">PAYMENT</text>
    <text x="310" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">üí≥ Process</text>
    <text x="310" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">payment</text>
    <text x="310" y="145" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">80% success</text>
  </g>
  
  <!-- Step 3: Ship -->
  <g>
    <rect x="450" y="70" width="120" height="80" rx="10" fill="#2d3748" stroke="#ed8936" stroke-width="2"/>
    <text x="510" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#ed8936">SHIP</text>
    <text x="510" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">üì¶ Generate</text>
    <text x="510" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">tracking #</text>
    <text x="510" y="145" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">Send email</text>
  </g>
  
  <!-- Step 4: Cancel (failure path) -->
  <g>
    <rect x="250" y="200" width="120" height="80" rx="10" fill="#2d3748" stroke="#e53e3e" stroke-width="2"/>
    <text x="310" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#e53e3e">CANCEL</text>
    <text x="310" y="245" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">‚ùå Handle</text>
    <text x="310" y="260" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">failure</text>
    <text x="310" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#e0e0e0">Notify customer</text>
  </g>
  
  <!-- Success Flow Arrows -->
  <defs>
    <marker id="arrow-success" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#68d391"/>
    </marker>
    <marker id="arrow-failure" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#e53e3e"/>
    </marker>
  </defs>
  
  <!-- Validate to Payment -->
  <line x1="170" y1="110" x2="250" y2="110" stroke="#68d391" stroke-width="2" marker-end="url(#arrow-success)"/>
  <text x="210" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#68d391">success</text>
  
  <!-- Payment to Ship -->
  <line x1="370" y1="110" x2="450" y2="110" stroke="#68d391" stroke-width="2" marker-end="url(#arrow-success)"/>
  <text x="410" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#68d391">paid</text>
  
  <!-- Payment to Cancel (failure path) -->
  <line x1="310" y1="150" x2="310" y2="200" stroke="#e53e3e" stroke-width="2" marker-end="url(#arrow-failure)"/>
  <text x="325" y="175" font-family="Arial, sans-serif" font-size="10" fill="#e53e3e">failed</text>
  
  <!-- Message Chaining -->
  <g>
    <rect x="50" y="320" width="700" height="100" rx="10" fill="#2d3748" stroke="#9f7aea" stroke-width="2"/>
    <text x="400" y="345" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#9f7aea">Message Chaining</text>
    <text x="400" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#e0e0e0">Each step publishes the next action automatically</text>
    
    <g>
      <text x="70" y="385" font-family="monospace" font-size="11" fill="#68d391">validate()</text>
      <text x="130" y="385" font-family="monospace" font-size="11" fill="#e0e0e0">‚Üí publish('process_payment')</text>
      
      <text x="300" y="385" font-family="monospace" font-size="11" fill="#4299e1">process_payment()</text>
      <text x="410" y="385" font-family="monospace" font-size="11" fill="#e0e0e0">‚Üí publish('ship')</text>
      
      <text x="70" y="405" font-family="monospace" font-size="11" fill="#e53e3e">process_payment()</text>
      <text x="180" y="405" font-family="monospace" font-size="11" fill="#e0e0e0">(on failure) ‚Üí publish('cancel')</text>
    </g>
  </g>
  
  <!-- Order Data Structure -->
  <g>
    <rect x="600" y="70" width="150" height="200" rx="10" fill="#1a202c" stroke="#4a5568" stroke-width="1"/>
    <text x="675" y="90" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#f6e05e">Order Data</text>
    
    <text x="610" y="110" font-family="monospace" font-size="9" fill="#e0e0e0">{</text>
    <text x="615" y="125" font-family="monospace" font-size="9" fill="#68d391">order_id:</text>
    <text x="665" y="125" font-family="monospace" font-size="9" fill="#e0e0e0">"ORD-1234",</text>
    <text x="615" y="140" font-family="monospace" font-size="9" fill="#68d391">total_amount:</text>
    <text x="685" y="140" font-family="monospace" font-size="9" fill="#f6e05e">99.99,</text>
    <text x="615" y="155" font-family="monospace" font-size="9" fill="#68d391">status:</text>
    <text x="650" y="155" font-family="monospace" font-size="9" fill="#e0e0e0">"new",</text>
    <text x="615" y="170" font-family="monospace" font-size="9" fill="#68d391">customer:</text>
    <text x="665" y="170" font-family="monospace" font-size="9" fill="#e0e0e0">{</text>
    <text x="625" y="185" font-family="monospace" font-size="9" fill="#4299e1">name:</text>
    <text x="655" y="185" font-family="monospace" font-size="9" fill="#e0e0e0">"John",</text>
    <text x="625" y="200" font-family="monospace" font-size="9" fill="#4299e1">email:</text>
    <text x="655" y="200" font-family="monospace" font-size="9" fill="#e0e0e0">"john@...",</text>
    <text x="625" y="215" font-family="monospace" font-size="9" fill="#4299e1">phone:</text>
    <text x="655" y="215" font-family="monospace" font-size="9" fill="#e0e0e0">"555-..."</text>
    <text x="615" y="230" font-family="monospace" font-size="9" fill="#e0e0e0">},</text>
    <text x="615" y="245" font-family="monospace" font-size="9" fill="#68d391">items:</text>
    <text x="645" y="245" font-family="monospace" font-size="9" fill="#e0e0e0">[...]</text>
    <text x="610" y="260" font-family="monospace" font-size="9" fill="#e0e0e0">}</text>
  </g>
  
  <!-- Status indicators -->
  <g>
    <circle cx="625" cy="450" r="8" fill="#68d391"/>
    <text x="640" y="455" font-family="Arial, sans-serif" font-size="12" fill="#e0e0e0">Success Path</text>
    
    <circle cx="625" cy="470" r="8" fill="#e53e3e"/>
    <text x="640" y="475" font-family="Arial, sans-serif" font-size="12" fill="#e0e0e0">Failure Path</text>
  </g>
</svg>