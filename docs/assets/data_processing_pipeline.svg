<svg width="1000" height="600" xmlns="http://www.w3.org/2000/svg">
  <rect width="1000" height="600" fill="transparent"/>
  
  <!-- Title -->
  <text x="500" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#e0e0e0">
    Data Processing Pipeline Example
  </text>
  
  <!-- Pipeline Stages -->
  <g>
    <text x="500" y="70" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#4299e1">
      Multi-Stage Data Processing Workflow
    </text>
    
    <!-- Stage 1: Ingest -->
    <rect x="50" y="100" width="180" height="80" rx="8" fill="#2d3748" stroke="#68d391" stroke-width="2"/>
    <text x="140" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#68d391">1. Data Ingestion</text>
    <text x="60" y="145" font-family="monospace" font-size="10" fill="#e0e0e0">• CSV uploads</text>
    <text x="60" y="160" font-family="monospace" font-size="10" fill="#e0e0e0">• API webhooks</text>
    <text x="60" y="175" font-family="monospace" font-size="10" fill="#e0e0e0">• Database exports</text>
    
    <!-- Stage 2: Validate -->
    <rect x="250" y="100" width="180" height="80" rx="8" fill="#2d3748" stroke="#4299e1" stroke-width="2"/>
    <text x="340" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#4299e1">2. Data Validation</text>
    <text x="260" y="145" font-family="monospace" font-size="10" fill="#e0e0e0">• Schema validation</text>
    <text x="260" y="160" font-family="monospace" font-size="10" fill="#e0e0e0">• Data quality checks</text>
    <text x="260" y="175" font-family="monospace" font-size="10" fill="#e0e0e0">• Duplicate detection</text>
    
    <!-- Stage 3: Transform -->
    <rect x="450" y="100" width="180" height="80" rx="8" fill="#2d3748" stroke="#9f7aea" stroke-width="2"/>
    <text x="540" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#9f7aea">3. Data Transform</text>
    <text x="460" y="145" font-family="monospace" font-size="10" fill="#e0e0e0">• Normalize formats</text>
    <text x="460" y="160" font-family="monospace" font-size="10" fill="#e0e0e0">• Calculate metrics</text>
    <text x="460" y="175" font-family="monospace" font-size="10" fill="#e0e0e0">• Enrich with lookups</text>
    
    <!-- Stage 4: Aggregate -->
    <rect x="650" y="100" width="180" height="80" rx="8" fill="#2d3748" stroke="#f6e05e" stroke-width="2"/>
    <text x="740" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#f6e05e">4. Data Aggregate</text>
    <text x="660" y="145" font-family="monospace" font-size="10" fill="#e0e0e0">• Group by dimensions</text>
    <text x="660" y="160" font-family="monospace" font-size="10" fill="#e0e0e0">• Statistical analysis</text>
    <text x="660" y="175" font-family="monospace" font-size="10" fill="#e0e0e0">• Time series rollups</text>
    
    <!-- Stage 5: Output -->
    <rect x="850" y="100" width="140" height="80" rx="8" fill="#2d3748" stroke="#e53e3e" stroke-width="2"/>
    <text x="920" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#e53e3e">5. Data Output</text>
    <text x="860" y="145" font-family="monospace" font-size="10" fill="#e0e0e0">• Database load</text>
    <text x="860" y="160" font-family="monospace" font-size="10" fill="#e0e0e0">• Dashboard update</text>
    <text x="860" y="175" font-family="monospace" font-size="10" fill="#e0e0e0">• Report generation</text>
  </g>
  
  <!-- Message Implementation -->
  <g>
    <text x="500" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#e0e0e0">
      DataProcessingMessage Implementation
    </text>
    
    <rect x="50" y="250" width="900" height="140" rx="8" fill="#2d3748" stroke="#4299e1" stroke-width="2"/>
    <text x="500" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#4299e1">Data Processing Message Class</text>
    
    <text x="70" y="300" font-family="monospace" font-size="11" fill="#68d391">class DataProcessingMessage &lt; BunnyFarm::Message</text>
    <text x="80" y="320" font-family="monospace" font-size="11" fill="#f6e05e">fields</text>
    <text x="130" y="320" font-family="monospace" font-size="11" fill="#e0e0e0">:batch_id, :source_type, :data_path, :schema_version, :processing_options</text>
    <text x="80" y="340" font-family="monospace" font-size="11" fill="#f6e05e">actions</text>
    <text x="140" y="340" font-family="monospace" font-size="11" fill="#e0e0e0">:ingest, :validate, :transform, :aggregate, :output, :cleanup</text>
    
    <text x="80" y="365" font-family="monospace" font-size="11" fill="#9f7aea">def ingest</text>
    <text x="90" y="380" font-family="monospace" font-size="11" fill="#e0e0e0">load_data and publish('validate')</text>
    <text x="80" y="395" font-family="monospace" font-size="11" fill="#9f7aea">end</text>
    
    <text x="350" y="365" font-family="monospace" font-size="11" fill="#9f7aea">def validate</text>
    <text x="360" y="380" font-family="monospace" font-size="11" fill="#e0e0e0">validate_schema and publish('transform')</text>
    <text x="350" y="395" font-family="monospace" font-size="11" fill="#9f7aea">end</text>
    
    <text x="620" y="365" font-family="monospace" font-size="11" fill="#9f7aea">def transform</text>
    <text x="630" y="380" font-family="monospace" font-size="11" fill="#e0e0e0">normalize_data and publish('aggregate')</text>
    <text x="620" y="395" font-family="monospace" font-size="11" fill="#9f7aea">end</text>
    
    <text x="70" y="415" font-family="monospace" font-size="11" fill="#68d391">end</text>
  </g>
  
  <!-- Processing Patterns -->
  <g>
    <text x="500" y="450" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#e0e0e0">
      Common Data Processing Patterns
    </text>
    
    <!-- Batch Processing -->
    <rect x="50" y="470" width="200" height="100" rx="6" fill="#1a202c" stroke="#68d391" stroke-width="1"/>
    <text x="150" y="490" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#68d391">Batch Processing</text>
    <text x="60" y="510" font-family="monospace" font-size="10" fill="#e0e0e0">Large file uploads</text>
    <text x="60" y="525" font-family="monospace" font-size="10" fill="#e0e0e0">Daily/hourly imports</text>
    <text x="60" y="540" font-family="monospace" font-size="10" fill="#e0e0e0">Scheduled ETL jobs</text>
    <text x="60" y="555" font-family="monospace" font-size="10" fill="#e0e0e0">Historical data migration</text>
    
    <!-- Stream Processing -->
    <rect x="270" y="470" width="200" height="100" rx="6" fill="#1a202c" stroke="#4299e1" stroke-width="1"/>
    <text x="370" y="490" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#4299e1">Stream Processing</text>
    <text x="280" y="510" font-family="monospace" font-size="10" fill="#e0e0e0">Real-time events</text>
    <text x="280" y="525" font-family="monospace" font-size="10" fill="#e0e0e0">API webhooks</text>
    <text x="280" y="540" font-family="monospace" font-size="10" fill="#e0e0e0">Sensor data</text>
    <text x="280" y="555" font-family="monospace" font-size="10" fill="#e0e0e0">User activity logs</text>
    
    <!-- Error Recovery -->
    <rect x="490" y="470" width="200" height="100" rx="6" fill="#1a202c" stroke="#e53e3e" stroke-width="1"/>
    <text x="590" y="490" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#e53e3e">Error Recovery</text>
    <text x="500" y="510" font-family="monospace" font-size="10" fill="#e0e0e0">Partial batch reprocessing</text>
    <text x="500" y="525" font-family="monospace" font-size="10" fill="#e0e0e0">Data quality quarantine</text>
    <text x="500" y="540" font-family="monospace" font-size="10" fill="#e0e0e0">Manual review queue</text>
    <text x="500" y="555" font-family="monospace" font-size="10" fill="#e0e0e0">Rollback capabilities</text>
    
    <!-- Monitoring -->
    <rect x="710" y="470" width="200" height="100" rx="6" fill="#1a202c" stroke="#9f7aea" stroke-width="1"/>
    <text x="810" y="490" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#9f7aea">Monitoring</text>
    <text x="720" y="510" font-family="monospace" font-size="10" fill="#e0e0e0">Processing metrics</text>
    <text x="720" y="525" font-family="monospace" font-size="10" fill="#e0e0e0">Data quality alerts</text>
    <text x="720" y="540" font-family="monospace" font-size="10" fill="#e0e0e0">Performance tracking</text>
    <text x="720" y="555" font-family="monospace" font-size="10" fill="#e0e0e0">SLA monitoring</text>
  </g>
  
  <!-- Flow arrows -->
  <defs>
    <marker id="arrow-data" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#ff9800"/>
    </marker>
  </defs>
  
  <line x1="230" y1="140" x2="250" y2="140" stroke="#ff9800" stroke-width="2" marker-end="url(#arrow-data)"/>
  <line x1="430" y1="140" x2="450" y2="140" stroke="#ff9800" stroke-width="2" marker-end="url(#arrow-data)"/>
  <line x1="630" y1="140" x2="650" y2="140" stroke="#ff9800" stroke-width="2" marker-end="url(#arrow-data)"/>
  <line x1="830" y1="140" x2="850" y2="140" stroke="#ff9800" stroke-width="2" marker-end="url(#arrow-data)"/>
</svg>