<svg width="900" height="600" xmlns="http://www.w3.org/2000/svg">
  <rect width="900" height="600" fill="transparent"/>
  
  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#e0e0e0">
    Actions DSL: Defining Message Behaviors
  </text>
  
  <!-- Action Declaration -->
  <g>
    <text x="450" y="70" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#f6e05e">
      Action Declaration and Implementation
    </text>
    
    <rect x="50" y="90" width="800" height="140" rx="8" fill="#2d3748" stroke="#f6e05e" stroke-width="2"/>
    <text x="450" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#f6e05e">Complete Action Definition</text>
    
    <text x="70" y="140" font-family="monospace" font-size="12" fill="#4299e1">class OrderMessage extends BunnyFarm::Message</text>
    <text x="80" y="160" font-family="monospace" font-size="12" fill="#68d391">fields</text>
    <text x="140" y="160" font-family="monospace" font-size="12" fill="#e0e0e0">:order_id, :customer_id, :items, :total</text>
    <text x="80" y="180" font-family="monospace" font-size="12" fill="#f6e05e">actions</text>
    <text x="150" y="180" font-family="monospace" font-size="12" fill="#e0e0e0">:validate, :process, :ship, :cancel</text>
    <text x="80" y="200" font-family="monospace" font-size="12" fill="#9f7aea">def validate</text>
    <text x="90" y="220" font-family="monospace" font-size="12" fill="#e0e0e0">check_inventory and validate_payment</text>
    <text x="80" y="240" font-family="monospace" font-size="12" fill="#9f7aea">end</text>
    <text x="70" y="260" font-family="monospace" font-size="12" fill="#4299e1">end</text>
  </g>
  
  <!-- Action Types -->
  <g>
    <text x="450" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#e0e0e0">
      Action Types and Patterns
    </text>
    
    <!-- Simple Actions -->
    <rect x="50" y="320" width="200" height="100" rx="6" fill="#2d3748" stroke="#68d391" stroke-width="2"/>
    <text x="150" y="345" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#68d391">Simple Actions</text>
    <text x="60" y="365" font-family="monospace" font-size="10" fill="#e0e0e0">def send_email</text>
    <text x="70" y="380" font-family="monospace" font-size="10" fill="#e0e0e0">EmailService.send(</text>
    <text x="80" y="395" font-family="monospace" font-size="10" fill="#e0e0e0">self[:recipient],</text>
    <text x="80" y="410" font-family="monospace" font-size="10" fill="#e0e0e0">self[:message])</text>
    <text x="60" y="425" font-family="monospace" font-size="10" fill="#e0e0e0">end</text>
    
    <!-- Workflow Actions -->
    <rect x="270" y="320" width="200" height="100" rx="6" fill="#2d3748" stroke="#4299e1" stroke-width="2"/>
    <text x="370" y="345" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#4299e1">Workflow Actions</text>
    <text x="280" y="365" font-family="monospace" font-size="10" fill="#e0e0e0">def process_order</text>
    <text x="290" y="380" font-family="monospace" font-size="10" fill="#e0e0e0">publish('validate')</text>
    <text x="290" y="395" font-family="monospace" font-size="10" fill="#e0e0e0">publish('charge')</text>
    <text x="290" y="410" font-family="monospace" font-size="10" fill="#e0e0e0">publish('fulfill')</text>
    <text x="280" y="425" font-family="monospace" font-size="10" fill="#e0e0e0">end</text>
    
    <!-- Conditional Actions -->
    <rect x="490" y="320" width="200" height="100" rx="6" fill="#2d3748" stroke="#9f7aea" stroke-width="2"/>
    <text x="590" y="345" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#9f7aea">Conditional Actions</text>
    <text x="500" y="365" font-family="monospace" font-size="10" fill="#e0e0e0">def handle_payment</text>
    <text x="510" y="380" font-family="monospace" font-size="10" fill="#e0e0e0">if premium_customer?</text>
    <text x="520" y="395" font-family="monospace" font-size="10" fill="#e0e0e0">fast_checkout</text>
    <text x="510" y="410" font-family="monospace" font-size="10" fill="#e0e0e0">else standard_flow</text>
    <text x="500" y="425" font-family="monospace" font-size="10" fill="#e0e0e0">end</text>
    
    <!-- Error Handling Actions -->
    <rect x="710" y="320" width="180" height="100" rx="6" fill="#2d3748" stroke="#e53e3e" stroke-width="2"/>
    <text x="800" y="345" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#e53e3e">Error Actions</text>
    <text x="720" y="365" font-family="monospace" font-size="10" fill="#e0e0e0">def retry_payment</text>
    <text x="730" y="380" font-family="monospace" font-size="10" fill="#e0e0e0">retry_count += 1</text>
    <text x="730" y="395" font-family="monospace" font-size="10" fill="#e0e0e0">if retry_count > 3</text>
    <text x="740" y="410" font-family="monospace" font-size="10" fill="#e0e0e0">publish('failed')</text>
    <text x="720" y="425" font-family="monospace" font-size="10" fill="#e0e0e0">end</text>
  </g>
  
  <!-- Action Execution Flow -->
  <g>
    <text x="450" y="470" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#e0e0e0">
      Action Execution and Routing
    </text>
    
    <!-- Publishing -->
    <rect x="50" y="490" width="160" height="60" rx="6" fill="#1a202c" stroke="#ff9800" stroke-width="1"/>
    <text x="130" y="515" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#ff9800">1. Publish</text>
    <text x="60" y="535" font-family="monospace" font-size="10" fill="#e0e0e0">message.publish('validate')</text>
    
    <!-- Routing -->
    <rect x="240" y="490" width="160" height="60" rx="6" fill="#1a202c" stroke="#f6e05e" stroke-width="1"/>
    <text x="320" y="515" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#f6e05e">2. Route</text>
    <text x="250" y="535" font-family="monospace" font-size="10" fill="#e0e0e0">OrderMessage.validate</text>
    
    <!-- Consume -->
    <rect x="430" y="490" width="160" height="60" rx="6" fill="#1a202c" stroke="#4299e1" stroke-width="1"/>
    <text x="510" y="515" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#4299e1">3. Consume</text>
    <text x="440" y="535" font-family="monospace" font-size="10" fill="#e0e0e0">Worker picks up message</text>
    
    <!-- Execute -->
    <rect x="620" y="490" width="160" height="60" rx="6" fill="#1a202c" stroke="#68d391" stroke-width="1"/>
    <text x="700" y="515" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#68d391">4. Execute</text>
    <text x="630" y="535" font-family="monospace" font-size="10" fill="#e0e0e0">message.validate()</text>
  </g>
  
  <!-- Flow arrows -->
  <defs>
    <marker id="arrow-action" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#ff9800"/>
    </marker>
  </defs>
  
  <line x1="210" y1="520" x2="240" y2="520" stroke="#ff9800" stroke-width="2" marker-end="url(#arrow-action)"/>
  <line x1="400" y1="520" x2="430" y2="520" stroke="#ff9800" stroke-width="2" marker-end="url(#arrow-action)"/>
  <line x1="590" y1="520" x2="620" y2="520" stroke="#ff9800" stroke-width="2" marker-end="url(#arrow-action)"/>
</svg>